# 修复页面跳转参数与逻辑不一致的计划

根据对比分析，发现 Android 版本与 Flutter 版本在页面跳转参数和处理逻辑上存在以下主要差异，需要进行修复：

## 1. HomeScreen 跳转 LibraryScreen 的参数
**差异**：
- **Flutter**: 使用 `latestItems` 列表中第一个元素的 `Type` 属性作为 `type` 参数传递。
- **Android**: 目前使用 `CollectionType` 属性。

**修复方案**:
- 修改 `HomeScreen.kt` 中跳转 Library 的逻辑，优先尝试获取 `latestItems` 第一个元素的 `Type`，如果获取不到则默认为空字符串，完全对齐 Flutter 逻辑。

## 2. PlayerScreen 的 `isSeries` 参数定义
**差异**:
- **Flutter**: 仅当媒体类型严格为 `"Series"` 时，`isSeries` 才为 `true`。播放单集 (`Episode`) 时，`isSeries` 为 `false`。
- **Android**: 目前逻辑是 `type == "Episode"` 时 `isSeries` 为 `true`，这与 Flutter 定义完全相反。

**修复方案**:
- 修改 `MainActivity.kt` 中的路由参数解析，将 `isSeries` 的赋值逻辑改为 `type == "Series"`。

## 3. PlayerScreen 的自动播放下一集逻辑
**差异**:
- **Flutter**: 自动播放下一集的判断**不依赖** `isSeries` 参数，而是检查 `SeriesId` 是否存在。
- **Android**: 目前逻辑依赖 `if (isSeries)` 判断，导致修正上述第 2 点后，自动播放功能会在播放单集时失效。

**修复方案**:
- 修改 `PlayerScreen.kt` 中的播放结束逻辑，移除对 `isSeries` 参数的依赖，改为检查 `mediaInfo["SeriesId"]` 是否存在，从而在播放单集 (`Episode`) 时也能正确触发下一集播放。

## 执行步骤
1.  **修改 `app/src/main/java/com/xxxx/emby_tv/ui/HomeScreen.kt`**: 更新 Library 跳转参数获取逻辑。
2.  **修改 `app/src/main/java/com/xxxx/emby_tv/MainActivity.kt`**: 修正 `isSeries` 参数传递逻辑。
3.  **修改 `app/src/main/java/com/xxxx/emby_tv/ui/PlayerScreen.kt`**: 修正自动播放下一集的触发条件。
